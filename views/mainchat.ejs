<!doctype html>
<html>
<head>
<link rel="stylesheet" href="/images/chat2style.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <p id='error'></p>
    <br>
    <p id='attop'></p>
	<div>
    <form>
      Change Body Color:<br>
      <input type='color' id='color' name='color'><br><br>
      <button onclick='clr()' type='button'>Set</button><br><br>
    </form>

    <% if(msgsfrom.length>0) { %>
    <p>You have got messages from </p>
    <% for(var i=0;i<msgsfrom.length;i++){ %>
    <li><%= msgsfrom[i] %></li>
    <% }} else { %>
    <p>No personal messages</p>
    <% } %>
    <br><br>
		<span>Pic: <%= pic %></span>
		<span>Name:<span id="name"><%= name %></span></span>
		<span>Number: <%= number %></span>
	</div>
    <div id='profile'></div>
	<button onclick="start()">Add me in</button>
    <ul id="users"></ul>
    <form><input type="text" id="msgval" ><button type="button" onclick="text()"> SAY IT </button> </form>
  <p id="chats"></p>

</body>
<script src="/socket.io/socket.io.js"></script>
<script>
      var socket=io.connect();

      var message='';var info='';var id=0;

      function clr(){
        document.body.style.backgroundColor=document.getElementById('color').value;
      }

      function start()
      {
      info=document.getElementById('name').innerHTML;
      socket.emit('new user',info);
           
      socket.on('adduser',function(data){
         id=data.uid;
      });
       
       socket.on('userExists', function(data) {
         document.getElementById('error').innerHTML = data;
      });
       
       socket.on('users',function(data){
        document.getElementById('users').innerHTML='';
        for(var i=0;i<data.length;i++){
          var cls= data[i].cls;
          var name=data[i].name;
          (document.getElementById('users').innerHTML)+='<li class =' + cls + '>' + name + '</li>' + '<form method="post" action="/profile/' + name + '"' + '>View Profile :<input type="submit" value="profile"></form><form method="post" action="/chat/' + name + '"' + '>Chat :<input type="submit" value="go"></form>' ;
      }});
      }

      function text()
      {
      message=document.getElementById('msgval').value;
      var n = document.getElementById('name').innerHTML;
      document.getElementById('msgval').value='';
      if(message) {
      socket.emit('send message',{msg:message,nme:n});
      }
      
      }
      socket.on('new message',function(data){
        document.getElementById('chats').innerHTML += '<div><b>' + data.name + ': </b>' + data.msg + '</div>';
      
      });
    

</script>
</html>